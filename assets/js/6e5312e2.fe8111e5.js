"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4528],{73770:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"directives/call","title":"@call","description":"The @call directive simplifies queries by composing together other resolvers, allowing to create a chain of resolvers that can be executed in sequence.\\"","source":"@site/docs/directives/call.md","sourceDirName":"directives","slug":"/call-directive","permalink":"/docs/call-directive","draft":false,"unlisted":false,"editUrl":"https://github.com/tailcallhq/tailcallhq.github.io/tree/develop/docs/directives/call.md","tags":[],"version":"current","lastUpdatedAt":1732818775000,"frontMatter":{"title":"@call","description":"The @call directive simplifies queries by composing together other resolvers, allowing to create a chain of resolvers that can be executed in sequence.\\"","slug":"../call-directive"},"sidebar":"docs","previous":{"title":"@cache","permalink":"/docs/cache-directive"},"next":{"title":"@discriminate","permalink":"/docs/discriminate"}}');var t=i(74848),r=i(28453);const a={title:"@call",description:'The @call directive simplifies queries by composing together other resolvers, allowing to create a chain of resolvers that can be executed in sequence."',slug:"../call-directive"},l=void 0,c={},o=[{value:"<code>@call</code> Directive Definition",id:"call-directive-definition",level:2},{value:"Example: Eliminating Redundancy",id:"example-eliminating-redundancy",level:2},{value:"Composing Resolvers with <code>steps</code>",id:"composing-resolvers-with-steps",level:2},{value:"Example: Invoking a Query",id:"example-invoking-a-query",level:3},{value:"Example: Invoking a Mutation",id:"example-invoking-a-mutation",level:3},{value:"Passing Arguments",id:"passing-arguments",level:3},{value:"Advanced Composition Example",id:"advanced-composition-example",level:2},{value:"Example: Composing Multiple Operations",id:"example-composing-multiple-operations",level:3},{value:"Running the Composed Query",id:"running-the-composed-query",level:3},{value:"Combining Multiple Directives",id:"combining-multiple-directives",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@call"})," directive simplifies GraphQL schema design by enabling resolver composition, allowing you to create chains of resolvers executed in sequence."]}),"\n",(0,t.jsxs)(n.h2,{id:"call-directive-definition",children:[(0,t.jsx)(n.code,{children:"@call"})," Directive Definition"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@call"})," directive is defined as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:'showLineNumbers title="Directive Definition"',children:'directive @call(\n  """\n  Array of steps to be executed in sequence. Each step can call a query or mutation.\n  """\n  steps: [CallStep!]!\n) on FIELD_DEFINITION\n\n"""\nInput type defining a single step in the call sequence\n"""\ninput CallStep {\n  """\n  Name of the query field to call\n  """\n  query: String\n\n  """\n  Name of the mutation field to call\n  """\n  mutation: String\n\n  """\n  Arguments to pass to the called field\n  """\n  args: JSON\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"example-eliminating-redundancy",children:"Example: Eliminating Redundancy"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@call"})," directive in GraphQL signifies a shift towards more efficient configuration management by introducing a methodology akin to function invocations in conventional programming. This directive is pivotal for developers navigating the intricacies of elaborate GraphQL schemas, where minimizing redundancy and adhering to the DRY (Don't Repeat Yourself) principle are paramount. Consider the following schema example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'schema {\n  query: Query\n}\n\ntype Query {\n  # highlight-start\n  user(id: Int!): User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users/{{.args.id}}"\n    )\n  # highlight-end\n  posts: [Post]\n    @http(url: "https://jsonplaceholder.typicode.com/posts")\n}\n\ntype Post {\n  id: Int!\n  userId: Int!\n  title: String!\n  body: String!\n  # highlight-start\n  user: User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users/{{.value.userId}}"\n    )\n  # highlight-end\n}\n\ntype User {\n  id: Int!\n  name: String!\n  email: String!\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["In this schema, at lines ",(0,t.jsx)(n.code,{children:"9"})," and ",(0,t.jsx)(n.code,{children:"18"}),", a pattern of configuration duplication emerges when fetching user's data by its id, demonstrating a prime use case for the ",(0,t.jsx)(n.code,{children:"@call"})," directive. Through refactoring the ",(0,t.jsx)(n.code,{children:"Post"})," type to incorporate the ",(0,t.jsx)(n.code,{children:"@call"})," directive, we can eliminate this redundancy."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Post {\n  id: Int!\n  userId: Int!\n  title: String!\n  body: String!\n  # highlight-start\n  user: User\n    @call(\n      steps: [\n        {query: "user", args: {id: "{{.value.userId}}"}}\n      ]\n    )\n  # highlight-end\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here, the ",(0,t.jsx)(n.code,{children:"@call"})," directive invokes the ",(0,t.jsx)(n.code,{children:"user"})," query from the ",(0,t.jsx)(n.code,{children:"Query"})," type, leveraging the data-fetching process that's already defined in the root ",(0,t.jsx)(n.code,{children:"query"}),". The ",(0,t.jsx)(n.code,{children:"query"})," parameter specifies the target field, while the ",(0,t.jsx)(n.code,{children:"args"})," parameter delineates the arguments to be passed."]}),"\n",(0,t.jsxs)(n.h2,{id:"composing-resolvers-with-steps",children:["Composing Resolvers with ",(0,t.jsx)(n.code,{children:"steps"})]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"steps"})," argument in the ",(0,t.jsx)(n.code,{children:"@call"})," directive is used to define a chain of resolvers, executed sequentially."]}),"\n",(0,t.jsx)(n.h3,{id:"example-invoking-a-query",children:"Example: Invoking a Query"}),"\n",(0,t.jsxs)(n.p,{children:["To invoke a query, specify the ",(0,t.jsx)(n.code,{children:"query"})," field to call, along with any required arguments:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Post {\n  userId: Int!\n  user: User\n    @call(\n      steps: [\n        {query: "user", args: {id: "{{.value.userId}}"}}\n      ]\n    )\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"example-invoking-a-mutation",children:"Example: Invoking a Mutation"}),"\n",(0,t.jsxs)(n.p,{children:["Similarly, you can invoke a mutation by specifying the ",(0,t.jsx)(n.code,{children:"mutation"})," parameter:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Mutation {\n  insertPost(input: PostInput, overwrite: Boolean): Post\n    @http(\n      body: "{{.args.input}}"\n      method: "POST"\n      url: "https://jsonplaceholder.typicode.com/posts"\n      query: {overwrite: "{{.args.overwrite}}"}\n    )\n\n  upsertPost(input: PostInput): Post\n    @call(\n      steps: [\n        {\n          mutation: "insertPost"\n          args: {input: "{{.args.input}}", overwrite: true}\n        }\n      ]\n    )\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"passing-arguments",children:"Passing Arguments"}),"\n",(0,t.jsxs)(n.p,{children:["Arguments can be passed using the ",(0,t.jsx)(n.code,{children:"args"})," parameter, where each key represents an argument name:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Post {\n  userId: Int!\n  user: User\n    @call(\n      steps: [\n        {query: "user", args: {id: "{{.value.userId}}"}}\n      ]\n    )\n}\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@call"})," directive is most useful in larger schemas with complex configurations. If you're just starting with GraphQL, consider mastering the basics before diving into advanced directives like ",(0,t.jsx)(n.code,{children:"@call"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"advanced-composition-example",children:"Advanced Composition Example"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@call"})," directive can be used to combine multiple resolvers in a sequence, passing the output of each step to the next. This allows for flexible composition of existing operations."]}),"\n",(0,t.jsx)(n.h3,{id:"example-composing-multiple-operations",children:"Example: Composing Multiple Operations"}),"\n",(0,t.jsxs)(n.p,{children:["Consider a scenario where we have three operations (",(0,t.jsx)(n.code,{children:"a"}),", ",(0,t.jsx)(n.code,{children:"b"}),", ",(0,t.jsx)(n.code,{children:"c"}),"), each extracting a specific part of the input:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'schema @server {\n  query: Query\n}\n\ntype Query {\n  a(input: JSON): JSON\n    @expr(body: {value: "{{.args.input.a}}"})\n\n  b(input: JSON): JSON\n    @expr(body: {value: "{{.args.input.b}}"})\n\n  c(input: JSON): JSON\n    @expr(body: {value: "{{.args.input.c}}"})\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["We can create a new ",(0,t.jsx)(n.code,{children:"abc"})," operation that calls ",(0,t.jsx)(n.code,{children:"a"}),", ",(0,t.jsx)(n.code,{children:"b"}),", and ",(0,t.jsx)(n.code,{children:"c"})," in sequence to extract deeply nested data:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",metastring:"showLineNumbers",children:'schema @server {\n  query: Query\n}\n\ntype Query {\n  a(input: JSON): JSON\n    @expr(body: {value: "{{.args.input.a}}"})\n\n  b(input: JSON): JSON\n    @expr(body: {value: "{{.args.input.b}}"})\n\n  c(input: JSON): JSON\n    @expr(body: {value: "{{.args.input.c}}"})\n\n  # highlight-start\n  abc(input: JSON): JSON\n    @call(\n      steps: [\n        {query: "a", args: {input: "{{.args.input}}"}}\n        {query: "b", args: {input: "{{.args.value}}"}}\n        {query: "c", args: {input: "{{.args.value}}"}}\n      ]\n    )\n  # highlight-end\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"running-the-composed-query",children:"Running the Composed Query"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-graphql",children:"query {\n  abc(input: {a: {b: {c: 1000}}})\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Response:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "data": {\n    "abc": {\n      "value": 100\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["This way you can compose combine multiple operations can compose them together using the ",(0,t.jsx)(n.code,{children:"@call"})," directive."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Using ",(0,t.jsx)(n.code,{children:"JSON"})," scalar here is for simplicity. In production, proper input and output types should be used for type safety."]})}),"\n",(0,t.jsx)(n.h2,{id:"combining-multiple-directives",children:"Combining Multiple Directives"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@call"})," directive can be used in combination with other ",(0,t.jsx)(n.a,{href:"/docs/tailcall-dsl-graphql-custom-directives#resolvable-directives",children:"resolvable directives"}),", with results merged deeply. This allows for powerful and flexible resolver configurations."]}),"\n",(0,t.jsxs)(n.p,{children:["For more details, see ",(0,t.jsx)(n.a,{href:"/docs/tailcall-dsl-graphql-custom-directives",children:"Directives Documentation"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var s=i(96540);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);