"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1252],{81052:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"directives/protected","title":"@protected","description":"The @protected directive ensures that a user must be authenticated to access certain data.","source":"@site/docs/directives/protected.md","sourceDirName":"directives","slug":"/protected-directive","permalink":"/tailcallhq.github.io/docs/protected-directive","draft":false,"unlisted":false,"editUrl":"https://github.com/tailcallhq/tailcallhq.github.io/tree/develop/docs/directives/protected.md","tags":[],"version":"current","lastUpdatedAt":1732498598000,"frontMatter":{"title":"@protected","description":"The @protected directive ensures that a user must be authenticated to access certain data.","slug":"../protected-directive"},"sidebar":"docs","previous":{"title":"@omit","permalink":"/tailcallhq.github.io/docs/omit-directive"},"next":{"title":"@rest","permalink":"/tailcallhq.github.io/docs/rest-directive"}}');var t=n(74848),r=n(28453);const d={title:"@protected",description:"The @protected directive ensures that a user must be authenticated to access certain data.",slug:"../protected-directive"},l=void 0,c={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Key Features:",id:"key-features",level:3},{value:"Behavior with Multiple <code>id</code> Values",id:"behavior-with-multiple-id-values",level:2},{value:"Example Usage",id:"example-usage",level:2},{value:"Schema",id:"schema",level:3},{value:"Authentication Files",id:"authentication-files",level:3},{value:"<code>.htpasswd_a</code>",id:"htpasswd_a",level:4},{value:"<code>.htpasswd_b</code>",id:"htpasswd_b",level:4},{value:"<code>.htpasswd_c</code>",id:"htpasswd_c",level:4},{value:"Scenarios",id:"scenarios",level:3},{value:"Type-Level vs Field-Level Protection",id:"type-level-vs-field-level-protection",level:2},{value:"Type-Level Protection",id:"type-level-protection",level:3},{value:"Field-Level Protection",id:"field-level-protection",level:3},{value:"Combined Use of Type and Field-Level Protection",id:"combined-use-of-type-and-field-level-protection",level:3},{value:"Explanation:",id:"explanation",level:4}];function o(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"@protected"})," directive ensures that a user must be authenticated to access certain data."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",metastring:'title="Directive Definition" showLineNumbers',children:'directive @protected(\n  """\n  Optional: A list of provider IDs that are required to access this field or type.\n  If omitted, authentication will be required from all providers.\n  To require access from specific providers, include multiple IDs.\n  """\n  id: [String!]\n) on OBJECT | FIELD_DEFINITION\n'})}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"@protected"})," directive designates a type or field as protected, meaning that only authenticated users can access it."]}),"\n",(0,t.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(i.p,{children:["To use the ",(0,t.jsx)(i.code,{children:"@protected"})," directive, you must configure at least one authentication provider using the ",(0,t.jsx)(i.a,{href:"/tailcallhq.github.io/docs/link-directive",children:(0,t.jsx)(i.code,{children:"@link"})})," directive, such as ",(0,t.jsx)(i.code,{children:"Htpasswd"})," or ",(0,t.jsx)(i.code,{children:"Jwks"}),"."]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",metastring:'title="Authentication Provider Configuration" showLineNumbers',children:'schema\n  @server\n  @upstream\n  @link(id: "basic", type: Htpasswd, src: ".htpasswd_a")\n  @link(id: "jwt", type: Jwks, src: "jwks.json") {\n  query: Query\n}\n'})}),"\n",(0,t.jsx)(i.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"@protected"})," directive adds an authentication check to the resolver execution chain, ensuring that users meet the specified authentication criteria."]}),"\n",(0,t.jsx)(i.h3,{id:"key-features",children:"Key Features:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Field-Level and Type-Level Protection"}),":"]}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The directive can be applied to both object types and individual fields. for example","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",children:"type Cat @protected {\n  meow: String\n  purr: String\n}\n"})}),"\n","or","\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",children:"type Cat {\n  meow: String @protected\n  purr: String @protected\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.ol,{start:"2",children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsxs)(i.strong,{children:["Authentication Providers (",(0,t.jsx)(i.code,{children:"id"})," Argument)"]}),":"]}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The optional ",(0,t.jsx)(i.code,{children:"id"})," argument specifies the authentication providers required to access the data."]}),"\n",(0,t.jsxs)(i.li,{children:["If multiple ",(0,t.jsx)(i.code,{children:"id"})," values are provided, all listed providers are required to access the data."]}),"\n",(0,t.jsxs)(i.li,{children:["If no ",(0,t.jsx)(i.code,{children:"id"})," is provided, all configured providers are required."]}),"\n"]}),"\n",(0,t.jsxs)(i.ol,{start:"3",children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Query Planning Optimization"}),":"]}),"\n"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:"During query execution, the authentication requirements for all fields in a query are merged and moved to the top of the execution plan."}),"\n",(0,t.jsx)(i.li,{children:"This eliminates redundant authentication checks for each field, significantly improving performance."}),"\n"]}),"\n",(0,t.jsxs)(i.h2,{id:"behavior-with-multiple-id-values",children:["Behavior with Multiple ",(0,t.jsx)(i.code,{children:"id"})," Values"]}),"\n",(0,t.jsxs)(i.p,{children:["When multiple ",(0,t.jsx)(i.code,{children:"id"})," values are provided in the ",(0,t.jsx)(i.code,{children:"@protected"})," directive, the system validates users against ",(0,t.jsx)(i.strong,{children:"all the specified providers"}),". For example:"]}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",children:'type Cat {\n  meow: String @protected(id: ["a", "c"])\n}\n'})}),"\n",(0,t.jsx)(i.p,{children:"In this case:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["A user authenticated via provider ",(0,t.jsx)(i.code,{children:"a"})," ",(0,t.jsx)(i.strong,{children:"and"})," provider ",(0,t.jsx)(i.code,{children:"c"})," is required to access the ",(0,t.jsx)(i.code,{children:"meow"})," field."]}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["If no ",(0,t.jsx)(i.code,{children:"id"})," argument is provided:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["The system allows access to users authenticated via ",(0,t.jsx)(i.strong,{children:"all configured providers"}),"."]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,t.jsx)(i.p,{children:"Consider the following schema and authentication configuration:"}),"\n",(0,t.jsx)(i.h3,{id:"schema",children:"Schema"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",metastring:"showLineNumbers",children:'schema\n  @server\n  @upstream\n  @link(id: "a", src: ".htpasswd_a", type: Htpasswd)\n  @link(id: "b", src: ".htpasswd_b", type: Htpasswd)\n  @link(id: "c", src: ".htpasswd_c", type: Htpasswd) {\n  query: Query\n}\n\ntype Query {\n  animals: [Animal!]!\n    @expr(\n      body: [\n        {Dog: {bark: "woof"}}\n        {Cat: {meow: "meow"}}\n        {Bird: {tweet: "tweet"}}\n      ]\n    )\n}\n\nunion Animal = Dog | Cat | Bird | Fish | Snake\n\ntype Dog {\n  bark: String @protected(id: ["a"])\n}\n\ntype Cat {\n  meow: String @protected(id: ["a", "c"])\n}\n\ntype Bird {\n  tweet: String @protected\n}\n'})}),"\n",(0,t.jsx)(i.h3,{id:"authentication-files",children:"Authentication Files"}),"\n",(0,t.jsx)(i.h4,{id:"htpasswd_a",children:(0,t.jsx)(i.code,{children:".htpasswd_a"})}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-text",children:"testuser1:$apr1$e3dp9qh2$fFIfHU9bilvVZBl8TxKzL/\ntestuser2:$2y$10$wJ/mZDURcAOBIrswCAKFsO0Nk7BpHmWl/XuhF7lNm3gBAFH3ofsuu\n"})}),"\n",(0,t.jsx)(i.h4,{id:"htpasswd_b",children:(0,t.jsx)(i.code,{children:".htpasswd_b"})}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-text",children:"testuser2:$2y$10$wJ/mZDURcAOBIrswCAKFsO0Nk7BpHmWl/XuhF7lNm3gBAFH3ofsuu\ntestuser3:{SHA}Y2fEjdGT1W6nsLqtJbGUVeUp9e4=\n"})}),"\n",(0,t.jsx)(i.h4,{id:"htpasswd_c",children:(0,t.jsx)(i.code,{children:".htpasswd_c"})}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-text",children:"testuser1:$apr1$e3dp9qh2$fFIfHU9bilvVZBl8TxKzL/\ntestuser3:{SHA}Y2fEjdGT1W6nsLqtJbGUVeUp9e4=\n"})}),"\n",(0,t.jsx)(i.h3,{id:"scenarios",children:"Scenarios"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsxs)(i.strong,{children:["Accessing ",(0,t.jsx)(i.code,{children:"Dog.bark"})," Field"]}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Authentication via provider ",(0,t.jsx)(i.code,{children:"a"})," is required."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Allowed Users"}),": ",(0,t.jsx)(i.code,{children:"testuser1"}),", ",(0,t.jsx)(i.code,{children:"testuser2"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsxs)(i.strong,{children:["Accessing ",(0,t.jsx)(i.code,{children:"Cat.meow"})," Field"]}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Authentication via providers ",(0,t.jsx)(i.code,{children:"a"})," ",(0,t.jsx)(i.strong,{children:"and"})," ",(0,t.jsx)(i.code,{children:"c"})," is required."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Allowed Users"}),": ",(0,t.jsx)(i.code,{children:"testuser1"})," (from ",(0,t.jsx)(i.code,{children:"a"})," and ",(0,t.jsx)(i.code,{children:"c"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsxs)(i.strong,{children:["Accessing ",(0,t.jsx)(i.code,{children:"Bird.tweet"})," Field"]}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Authentication via ",(0,t.jsx)(i.strong,{children:"all configured providers"})," is required."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Allowed Users"}),": None, as no user is present in all providers."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.h2,{id:"type-level-vs-field-level-protection",children:"Type-Level vs Field-Level Protection"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"@protected"})," directive can be applied at both the type and field levels. Here\u2019s how they interact and the advantages of using each:"]}),"\n",(0,t.jsx)(i.h3,{id:"type-level-protection",children:"Type-Level Protection"}),"\n",(0,t.jsxs)(i.p,{children:["Applying ",(0,t.jsx)(i.code,{children:"@protected"})," at the type level ensures all fields within the type are protected. This reduces redundancy, as you don\u2019t need to annotate each field individually."]}),"\n",(0,t.jsx)(i.h3,{id:"field-level-protection",children:"Field-Level Protection"}),"\n",(0,t.jsxs)(i.p,{children:["If specific fields within a type require different authentication rules, you can apply ",(0,t.jsx)(i.code,{children:"@protected"})," at the field level. Field-level rules are merged with type-level rules."]}),"\n",(0,t.jsx)(i.h3,{id:"combined-use-of-type-and-field-level-protection",children:"Combined Use of Type and Field-Level Protection"}),"\n",(0,t.jsxs)(i.p,{children:["When ",(0,t.jsx)(i.code,{children:"@protected"})," is applied at both the type and field levels, the rules are ",(0,t.jsx)(i.strong,{children:"merged and moved to the top of the query execution plan"}),". This ensures authentication checks are performed efficiently without redundant processing."]}),"\n",(0,t.jsx)(i.p,{children:"For example:"}),"\n",(0,t.jsx)(i.pre,{children:(0,t.jsx)(i.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Pet @protected(id: ["a"]) {\n  name: String\n  age: Int\n  breed: String @protected(id: ["c"])\n}\n'})}),"\n",(0,t.jsx)(i.h4,{id:"explanation",children:"Explanation:"}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsxs)(i.strong,{children:["Type-Level Rule (",(0,t.jsx)(i.code,{children:'id: ["a"]'}),")"]}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Protects all fields (",(0,t.jsx)(i.code,{children:"name"}),", ",(0,t.jsx)(i.code,{children:"age"}),", and ",(0,t.jsx)(i.code,{children:"breed"}),")."]}),"\n",(0,t.jsxs)(i.li,{children:["Requires authentication via provider ",(0,t.jsx)(i.code,{children:"a"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsxs)(i.strong,{children:["Field-Level Rule (",(0,t.jsx)(i.code,{children:"breed"})," with ",(0,t.jsx)(i.code,{children:'id: ["c"]'}),")"]}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["Adds provider ",(0,t.jsx)(i.code,{children:"c"})," for the ",(0,t.jsx)(i.code,{children:"breed"})," field."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.strong,{children:"Merged Authentication Rule:"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["For fields like ",(0,t.jsx)(i.code,{children:"name"})," and ",(0,t.jsx)(i.code,{children:"age"}),", authentication via provider ",(0,t.jsx)(i.code,{children:"a"})," suffices."]}),"\n",(0,t.jsxs)(i.li,{children:["For the ",(0,t.jsx)(i.code,{children:"breed"})," field, authentication via both ",(0,t.jsx)(i.code,{children:"a"})," and ",(0,t.jsx)(i.code,{children:"c"})," is required."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},28453:(e,i,n)=>{n.d(i,{R:()=>d,x:()=>l});var s=n(96540);const t={},r=s.createContext(t);function d(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);