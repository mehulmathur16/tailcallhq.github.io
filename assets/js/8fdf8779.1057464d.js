"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5944],{23415:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"directives/http","title":"@http","description":"The @http directive indicates a field or node relies on a REST API.","source":"@site/docs/directives/http.md","sourceDirName":"directives","slug":"/http-directive","permalink":"/docs/http-directive","draft":false,"unlisted":false,"editUrl":"https://github.com/tailcallhq/tailcallhq.github.io/tree/develop/docs/directives/http.md","tags":[],"version":"current","lastUpdatedAt":1734952853000,"frontMatter":{"title":"@http","description":"The @http directive indicates a field or node relies on a REST API.","slug":"../http-directive"},"sidebar":"docs","previous":{"title":"@grpc","permalink":"/docs/grpc-directive"},"next":{"title":"@js","permalink":"/docs/js-directive"}}');var r=n(74848),i=n(28453);const l={title:"@http",description:"The @http directive indicates a field or node relies on a REST API.",slug:"../http-directive"},a=void 0,d={},c=[{value:"<code>@http</code> Directive Definition",id:"http-directive-definition",level:2},{value:"Example: Basic Usage of <code>@http</code>",id:"example-basic-usage-of-http",level:2},{value:"Directive Arguments",id:"directive-arguments",level:2},{value:"url",id:"url",level:3},{value:"method",id:"method",level:3},{value:"query",id:"query",level:3},{value:"Query Fields:",id:"query-fields",level:4},{value:"body",id:"body",level:3},{value:"headers",id:"headers",level:3},{value:"batchKey",id:"batchkey",level:3},{value:"onRequest",id:"onrequest",level:3},{value:"onResponseBody",id:"onresponsebody",level:3},{value:"select",id:"select",level:3},{value:"dedupe",id:"dedupe",level:3},{value:"Batching with POST Requests",id:"batching-with-post-requests",level:2},{value:"Mechanism",id:"mechanism",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Current Limitations",id:"current-limitations",level:3},{value:"Combining Multiple Directives",id:"combining-multiple-directives",level:2}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"@http"})," directive enables GraphQL fields to be resolved using REST API endpoints, simplifying the integration of external data sources."]}),"\n",(0,r.jsxs)(s.h2,{id:"http-directive-definition",children:[(0,r.jsx)(s.code,{children:"@http"})," Directive Definition"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:'title="Directive Definition" showLineNumbers',children:"directive @http(\n  url: String!\n  method: Method\n  query: [InputKeyValue!]\n  body: JSON\n  headers: [InputKeyValue!]\n  batchKey: [String!]\n  onRequest: String\n  onResponseBody: String\n  select: JSON\n  dedupe: Boolean\n) on FIELD_DEFINITION\n"})}),"\n",(0,r.jsxs)(s.h2,{id:"example-basic-usage-of-http",children:["Example: Basic Usage of ",(0,r.jsx)(s.code,{children:"@http"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Query {\n  users: [User]\n    @http(url: "https://jsonplaceholder.typicode.com/users")\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["In this example, adding the ",(0,r.jsx)(s.code,{children:"@http"})," directive to the ",(0,r.jsx)(s.code,{children:"users"})," field of the ",(0,r.jsx)(s.code,{children:"Query"})," type indicates reliance on a REST API for the ",(0,r.jsx)(s.code,{children:"users"})," field. The ",(0,r.jsx)(s.a,{href:"#url",children:"url"})," argument specifies the REST API's url, which is ",(0,r.jsx)(s.code,{children:"https://jsonplaceholder.typicode.com/users"})," in this scenario. Querying the ",(0,r.jsx)(s.code,{children:"users"})," field prompts the GraphQL server to issue a GET request to ",(0,r.jsx)(s.code,{children:"https://jsonplaceholder.typicode.com/users"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"directive-arguments",children:"Directive Arguments"}),"\n",(0,r.jsx)(s.h3,{id:"url",children:"url"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"url"})," parameter defines the API endpoint. It can also contain dynamic segments with Mustache templates for variable substitution:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Query {\n  user(id: ID!): User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users/{{.args.id}}"\n    )\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"method",children:"method"}),"\n",(0,r.jsxs)(s.p,{children:["Specifies the HTTP method for the request. Defaults to ",(0,r.jsx)(s.code,{children:"GET"})," if not specified:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Mutation {\n  createUser(input: UserInput!): User\n    @http(\n      method: "POST"\n      url: "https://jsonplaceholder.typicode.com/users"\n    )\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"query",children:"query"}),"\n",(0,r.jsx)(s.p,{children:"Represents the API call's query parameters, either as a static object or with dynamic parameters using Mustache templates. These parameters append to the URL."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Query {\n  userPosts(id: ID!): [Post]\n    @http(\n      url: "https://jsonplaceholder.typicode.com/posts"\n      query: [\n        {\n          key: "userId"\n          value: "{{.args.id}}"\n          skipEmpty: false\n        }\n      ]\n    )\n}\n'})}),"\n",(0,r.jsx)(s.h4,{id:"query-fields",children:"Query Fields:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"key"})," : Represents the name of the query parameter."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"value"})," : A string literal or a mustache template representing the value of query parameter."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"skipEmpty"})," : When set to ",(0,r.jsx)(s.code,{children:"true"})," the query parameter is skipped if the value of the parameter is null, defaults to false."]}),"\n"]}),"\n",(0,r.jsx)(s.admonition,{type:"important",children:(0,r.jsxs)(s.p,{children:["When ",(0,r.jsx)(s.code,{children:"batchKey"})," is present, Tailcall considers the first ",(0,r.jsx)(s.code,{children:"query"})," parameter to be the batch query key, so remember to adjust the order of the items accordingly."]})}),"\n",(0,r.jsx)(s.h3,{id:"body",children:"body"}),"\n",(0,r.jsx)(s.p,{children:"Defines the API call's body, necessary for methods like POST or PUT. Pass it as a static object or use Mustache templates for variable substitution from the GraphQL variables."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Mutation {\n  createUser(input: UserInput!): User\n    @http(\n      method: "POST"\n      url: "https://jsonplaceholder.typicode.com/users"\n      body: "{{.args.input}}"\n    )\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["In the example above, the ",(0,r.jsx)(s.code,{children:"createUser"})," mutation sends a POST request to ",(0,r.jsx)(s.code,{children:"/users"}),", with the input object converted to JSON and included in the request body."]}),"\n",(0,r.jsx)(s.h3,{id:"headers",children:"headers"}),"\n",(0,r.jsxs)(s.p,{children:["Customizes the HTTP request headers made by the ",(0,r.jsx)(s.code,{children:"@http"})," directive. Specify a key-value map of header names and values."]}),"\n",(0,r.jsx)(s.p,{children:"For instance:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Mutation {\n  createUser(input: UserInput!): User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users"\n      headers: [{key: "X-Server", value: "Tailcall"}]\n    )\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["In this example, a request to ",(0,r.jsx)(s.code,{children:"/users"})," will include a HTTP header ",(0,r.jsx)(s.code,{children:"X-Server"})," with the value ",(0,r.jsx)(s.code,{children:"Tailcall"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["You can make use of mustache templates to provide dynamic values for headers, derived from the arguments or ",(0,r.jsx)(s.a,{href:"/docs/graphql-resolver-context-tailcall",children:"context"})," provided in the request. For example:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Mutation {\n  users(name: String): User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users"\n      headers: [\n        {key: "X-Server", value: "Tailcall"}\n        {key: "User-Name", value: "{{.args.name}}"}\n      ]\n    )\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["In this scenario, the ",(0,r.jsx)(s.code,{children:"User-Name"})," header's value will dynamically adjust according to the ",(0,r.jsx)(s.code,{children:"name"})," argument passed in the request."]}),"\n",(0,r.jsx)(s.h3,{id:"batchkey",children:"batchKey"}),"\n",(0,r.jsxs)(s.p,{children:["Groups data requests into a single call, enhancing efficiency. Refer to our ",(0,r.jsx)(s.a,{href:"/docs/graphql-n-plus-one-problem-solved-tailcall",children:"n + 1 guide"})," for more details."]}),"\n",(0,r.jsx)(s.admonition,{type:"important",children:(0,r.jsxs)(s.p,{children:["When ",(0,r.jsx)(s.code,{children:"batchKey"})," is present, Tailcall considers the first ",(0,r.jsx)(s.code,{children:"query"})," parameter to be the batch query key, so remember to adjust the order of the items accordingly. Whereas, the last item from ",(0,r.jsx)(s.code,{children:"batchKey"})," is used to instruct which field is the ID of an object. In case that the returned result is a nested property ",(0,r.jsx)(s.code,{children:"batchKey"})," can be used as a path to extract and group the items for the returned result."]})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Post {\n  id: Int!\n  name: String!\n  userId: Int!\n  user: User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users"\n      query: [{key: "user_id", value: "{{.value.userId}}"}]\n      batchKey: ["users", "id"]\n    )\n}\n'})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:'query: {key: "user_id", value: "{{.value.userId}}"}]'}),": Instructs Tailcall CLI to generate a URL aligning the user id with ",(0,r.jsx)(s.code,{children:"userId"})," from the parent ",(0,r.jsx)(s.code,{children:"Post"}),", compiling a single URL for a batch of posts, such as ",(0,r.jsx)(s.code,{children:"/users?user_id=1&user_id=2&user_id=3...user_id=10"}),", consolidating requests into one."]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"onrequest",children:"onRequest"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"onRequest"})," property accepts a string value representing the remote function to be called every time an HTTP request is initiated. Typically the remote function is defined in a linked JavaScript worker file."]}),"\n",(0,r.jsx)(s.admonition,{type:"note",children:(0,r.jsxs)(s.p,{children:["For defining a request middleware globally for all requests, refer to the ",(0,r.jsx)(s.a,{href:"/docs/upstream-configuration#onrequest",children:"upstream config documentation"}),"."]})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Query {\n  userPosts(id: ID!): [Post]\n    @http(\n      url: "https://jsonplaceholder.typicode.com/posts"\n      query: [{key: "userId", value: "{{.args.id}}"}]\n      onRequest: "someFunctionName"\n    )\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"onresponsebody",children:"onResponseBody"}),"\n",(0,r.jsxs)(s.p,{children:["This hook allows you to intercept and modify the response body from upstream services before it's processed by Tailcall. Like ",(0,r.jsx)(s.a,{href:"#onrequest",children:"onRequest"}),", it accepts a string value representing a middleware function defined in a JavaScript file. This function can be used to transform or validate the response data."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Query {\n  user(id: Int!): User\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users/{{.args.id}}"\n      onResponseBody: "onResponse"\n    )\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"select",children:"select"}),"\n",(0,r.jsxs)(s.p,{children:["You can use ",(0,r.jsx)(s.code,{children:"select"})," with mustache syntax to re-construct the directives\nresponse to the desired format. This is useful when data are deeply\nnested or want to keep specific fields only from the response."]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["EXAMPLE 1: if we have a call that returns ",(0,r.jsx)(s.code,{children:'{ "user": { "items": [...], ... } ... }'})," we can use ",(0,r.jsx)(s.code,{children:'"{{.user.items}}"'}),", to extract the ",(0,r.jsx)(s.code,{children:"items"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["EXAMPLE 2: if we have a call that returns ",(0,r.jsx)(s.code,{children:'{ "foo": "bar", "fizz": { "buzz": "eggs", ... }, ... }'})," we can use ",(0,r.jsx)(s.code,{children:'{ foo: "{{.foo}}", buzz: "{{.fizz.buzz}}" }'})]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'type Query {\n  userCompany(id: Int!): Company\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users/{{.args.id}}"\n      select: "{{.company}}"\n    )\n  userDetails(id: Int!): UserDetails\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users/{{.args.id}}"\n      select: {\n        id: "{{.id}}"\n        city: "{{.address.city}}"\n        phone: "{{.phone}}"\n      }\n    )\n}\n'})}),"\n",(0,r.jsx)(s.h3,{id:"dedupe",children:"dedupe"}),"\n",(0,r.jsxs)(s.p,{children:["A boolean flag, if set to ",(0,r.jsx)(s.code,{children:"true"}),", will enable deduplication of IO operations to enhance performance. This flag prevents duplicate IO requests from being executed concurrently, reducing resource load. If not specified, this feature defaults to ",(0,r.jsx)(s.code,{children:"false"}),"."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",metastring:"showLineNumbers",children:'@http(\n  url: "https://jsonplaceholder.typicode.com/users/"\n  dedupe: true\n)\n'})}),"\n",(0,r.jsx)(s.h2,{id:"batching-with-post-requests",children:"Batching with POST Requests"}),"\n",(0,r.jsx)(s.p,{children:"In some cases, your batch API might use a POST request that accepts a list of items for processing. Tailcall can batch these requests similarly to how it handles GET requests, but instead of sending the input in query parameters, it sends them in the request body."}),"\n",(0,r.jsx)(s.h3,{id:"mechanism",children:"Mechanism"}),"\n",(0,r.jsx)(s.p,{children:"When Tailcall receives multiple POST requests that share the same endpoint but have different parameters, it:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"Collects these requests"}),"\n",(0,r.jsx)(s.li,{children:"Transforms them into a single POST request with an array of objects in the body"}),"\n",(0,r.jsx)(s.li,{children:"Sends this consolidated request to the upstream service"}),"\n",(0,r.jsx)(s.li,{children:"Maps the responses back to individual results"}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(s.p,{children:"To enable batching, configure your schema as follows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",children:'type Query {\n  posts: [Post]\n    @http(url: "https://jsonplaceholder.typicode.com/posts")\n}\n\ntype Post {\n  id: ID!\n  name: String!\n  user: User!\n    @http(\n      url: "https://jsonplaceholder.typicode.com/users"\n      method: POST\n      body: {\n        userId: "{{.value.userId}}"\n        staticValue: "static"\n      }\n      batchKey: ["userId"]\n    )\n}\n\ntype User {\n  id: ID!\n  name: String!\n}\n'})}),"\n",(0,r.jsxs)(s.p,{children:["In this example, the ",(0,r.jsx)(s.code,{children:"posts"})," query fetches a list of posts, and the ",(0,r.jsx)(s.code,{children:"user"})," field fetches user details for each post. The ",(0,r.jsx)(s.code,{children:"batchKey"})," parameter groups the user requests into a single POST request, enhancing efficiency."]}),"\n",(0,r.jsx)(s.p,{children:"Let's say your GraphQL query needs to fetch user details for multiple posts:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-graphql",children:"query {\n  posts {\n    id\n    name\n    user {\n      id\n      name\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"The posts endpoint returns:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'[\n  {\n    "id": 1,\n    "name": "post-1",\n    "userId": 1\n  },\n  {\n    "id": 2,\n    "name": "post-2",\n    "userId": 2\n  }\n]\n'})}),"\n",(0,r.jsx)(s.p,{children:"Instead of making separate POST requests for each user, Tailcall will batch them into a single request:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:'POST https://jsonplaceholder.typicode.com/users\nContent-Type: application/json\nBody:\n[\n  {\n    "userId": 1,\n    "staticValue": "static"\n  },\n  {\n    "userId": 2,\n    "staticValue": "static"\n  }\n]\n'})}),"\n",(0,r.jsx)(s.h3,{id:"current-limitations",children:"Current Limitations"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Currently, supports only one dynamic parameter per batched request"}),"\n",(0,r.jsx)(s.li,{children:"All requests in a batch must share the same endpoint and method"}),"\n",(0,r.jsxs)(s.li,{children:["The dynamic parameter must be referenced using the ",(0,r.jsx)(s.code,{children:"{{.value.fieldName}}"})," syntax"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"combining-multiple-directives",children:"Combining Multiple Directives"}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"@http"})," directive can be used in combination with other ",(0,r.jsx)(s.a,{href:"/docs/tailcall-dsl-graphql-custom-directives#resolvable-directives",children:"resolvable directives"}),", with results merged deeply. This allows for powerful and flexible resolver configurations."]}),"\n",(0,r.jsxs)(s.p,{children:["For more details, see ",(0,r.jsx)(s.a,{href:"/docs/tailcall-dsl-graphql-custom-directives",children:"Directives Documentation"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>a});var t=n(96540);const r={},i=t.createContext(r);function l(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);